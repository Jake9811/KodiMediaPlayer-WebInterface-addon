<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget</title>
<style>
/* w: 660px ; h: 200px */
html {
	box-sizing: border-box;
	display: block;
}
*, *:before, *:after {
	box-sizing: inherit;
}
body {
    height: 100px;
    margin: 0;
    overflow: hidden;
}
.widget {
    display: grid;
    grid-template-columns: 30px 30px 30px 30px 30px 85px 85px;
    grid-template-rows: 50px 50px;
    background: linear-gradient(to bottom, black 0%, black 50%, white 50%, white 100%);
}
.thumb {
    grid-column: 1 / 3;
    margin: 0 5px;
    background-image: url('https://lauft.work/wp-content/themes/LAUFT/img/lauft_trio_reverse.svg');
    background-position: center;
	background-size: cover;
    background-repeat: no-repeat;
    background-color: white;
}
.title {
    grid-column: 3 / -1;
    margin: 5px 10px 5px 5px;
    color: white;
    font-family: 'Source Sans Pro', sans-serif;
    font-weight: bold;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
    cursor: default;
}
.control-buttons {
    width: 20px;
    margin: 15px auto;
    cursor: pointer;
}
.control-buttons:hover {
    background-color: #41b6e6;
}
.control-buttons:active {
    outline: 5px double #41b6e6;
}
.slidecontainer {
    margin-left: -3px;
    width: 85px;
}
.slider {
    -webkit-appearance: none;
	appearance: none;
    width: 100%;
    height: 12px;
	margin-top: 19px;
	border-radius: 5px;
	background: linear-gradient(to right, #41b6e6 0%, #41b6e6 50%, #d3d3d3 50%, #d3d3d3 100%);
	outline: none;
	overflow: visible;
}
.slider::-webkit-slider-thumb {
	-webkit-appearance: none;
	appearance: none;
	width: 20px;
	height: 20px;
	border-radius: 50%; 
	background: black;
	cursor: pointer;
}
.slider::-moz-range-thumb {
	width: 20px;
	height: 20px;
	border-radius: 50%;
	background: black;
	cursor: pointer;
}
#play_pause {
    background: linear-gradient(to right, black 0%, black  35%, white 35%, white 65%, black 65%, black 100%);
}
#play_pause:hover {
    background: linear-gradient(to right, black 0%, black  35%, #41b6e6 35%, #41b6e6 65%, black 65%, black 100%);
}
.play {
    border-top: 10px solid transparent;
	border-left: 20px solid black;
	border-bottom: 10px solid transparent;
}
.play:hover {
    border-top: 10px solid #41b6e6;
	border-left: 20px solid black;
	border-bottom: 10px solid #41b6e6;
}
#stop {
    background: black;
}
.next {
    display: inline-block;
    border-top: 10px solid transparent;
	border-left: 10px solid black;
	border-bottom: 10px solid transparent;
}
.previous {
    display: inline-block;
    border-top: 10px solid transparent;
	border-right: 10px solid black;
	border-bottom: 10px solid transparent;
}
#volume-button {
    cursor: default;
    position: relative;
    width: 15px;
    border-top: 10px solid transparent;
	border-right: 12px solid black;
    border-bottom: 10px solid transparent;
    margin-right: 15px;
}
#volume-button:before {
    content: "";
    position: absolute;
    top: -5px;
    left: 2px;
    width: 10px;
    height: 10px;
    background-color: black;
}
#volume-button:after {
    content: "";
    position: absolute;
    top: -7px;
    left: 17px;
    width: 7px;
    height: 14px;
    border-radius: 0 7px 7px 0;
    background-color: black;
}
#volume-button:hover {
	background: none;
}
#volume-button:active {
	outline: none;
}
.reboot {
    width: 70px;
    margin: auto;
    background-color: white;
    border: 1px solid black;
    border-radius: 5px;
    font-family: 'Lato', sans-serif;
    cursor: pointer;
}
.reboot:hover {
    color: white;
    background-color: black;
}
.reboot:active {
    border-radius: 10px;
    transition: none;
}
.reboot:focus {
    outline: none;
}
</style>
</head>
<body>
    <div class="widget">
        <div class="thumb" id="thumb"></div>
        <div class="title" id="title">Now Playing</div>
        <div class="control-buttons"  onclick="previous()"><div class="previous"></div><div class="previous"></div></div>
        <div class="control-buttons play"  onclick="playPause()" id="play_pause"></div>
        <div class="control-buttons"  onclick="stop()" id="stop"></div>
        <div class="control-buttons"  onclick="next()"><div class="next"></div><div class="next"></div></div>
        <div class="control-buttons"  id="volume-button"></div>
        <div class="slidecontainer">
            <input type="range" min="0" max="100" value="50" class="slider" id="myRange" oninput="volume()">
        </div>
        <input class="reboot" type="button" value="REBOOT" onclick="reboot()">
    </div>
<script>
document.getElementById('myRange').addEventListener('input',volumeChange)
const serverURL = 'localhost'
var connection = new WebSocket('ws://'+serverURL+':9090/jsonrpc')
connection.onopen = function () {
    console.log('URL: '+connection.url+' CONNECTED: '+(connection.readyState==1?'YES':'NO'));
    connection.send(JSON.stringify(
        [
            {"jsonrpc": "2.0", "method": "Player.GetProperties", "params": { "playerid": 0, "properties": [ "speed" ] }, "id": 1},
            {"jsonrpc": "2.0", "method": "Application.GetProperties", "params": { "properties": [ "volume" ] }, "id": 2},
            {"jsonrpc": "2.0", "method": "Player.GetItem", "params": { "playerid": 0, "properties": ["title","thumbnail"] }, "id": 3}
        ]
    ))
};
connection.onerror = function (error) {
    console.log('URL: '+connection.url+' ERROR: ',error);
};
async function SEND(method,params) {
    console.log('Client('+serverURL+'): '+method,params)
    connection.send(JSON.stringify({"jsonrpc": "2.0", "method": method, "params": params}))
}
connection.onmessage = async function (e) {
    if(e.data) {
        var listen = JSON.parse(e.data)
        //console.log(listen)
        if(listen.method) {
            var task = listen.method
            var props = listen.params.data
            console.log('Server('+serverURL+'): ' + task,props);
            if (task == "Application.OnVolumeChanged") {
                document.getElementById('myRange').value = props.volume
                volumeChange()
            }
            else if (task == "Player.OnPause") {
                document.getElementById('play_pause').classList.toggle('play',true)
            }
            else if (task == "Player.OnPlay") {
                document.getElementById('play_pause').classList.toggle('play',false)
                if(props.item.title) {
                    document.getElementById('title').innerText = props.item.title
                    console.log('Now Playing('+serverURL+'): '+props.item.title)
                }
                else { 
                    document.getElementById('title').innerText = "No Title Found"
                    console.log('Now Playing('+serverURL+'): '+'No Title Found')
                }
                connection.send(JSON.stringify({"jsonrpc": "2.0", "method": "Player.GetItem", "params": { "playerid": 0, "properties": ["thumbnail"] }, "id": 1}))
            }
            else if (task == "Player.OnStop") {
                document.getElementById('title').innerText = "Now Playing"
                document.getElementById('play_pause').classList.toggle('play',true)
                document.getElementById('thumb').style.backgroundImage = 'url(\'https://lauft.work/wp-content/themes/LAUFT/img/lauft_trio_reverse.svg\')';
            }
        }
        else if (!listen.length) {
            if(listen.result.item.thumbnail) { document.getElementById('thumb').style.backgroundImage = 'url(\'http://'+serverURL+'/image/'+encodeURIComponent(listen.result.item.thumbnail)+'\')' }
        }
        else {
            if (listen[0].result.speed == 1) { document.getElementById('play_pause').classList.toggle('play',false) }
            if(String(listen[1].result.volume)) { document.getElementById('myRange').value = listen[1].result.volume;volumeChange() }
            if(listen[2].result.item.title) { document.getElementById('title').innerText = listen[2].result.item.title;console.log('Now Playing('+serverURL+'): '+listen[2].result.item.title) }
            if(listen[2].result.item.thumbnail) { document.getElementById('thumb').style.backgroundImage = 'url(\'http://'+serverURL+'/image/'+encodeURIComponent(listen[2].result.item.thumbnail)+'\')' }
        }
    }
};
async function volumeChange() {
    var slider = document.getElementById('myRange')
    slider.style.background = 'linear-gradient(to right, #41b6e6 0%, #41b6e6 ' + slider.value + '%, #d3d3d3 ' + slider.value + '%, #d3d3d3 100%)'
}
async function volume() {
    var method = "Application.SetVolume"
    var params = { "volume": Number(document.getElementById('myRange').value) }
    SEND(method,params)
}
async function playPause() {
    var method = "Player.PlayPause"
    var params = { "playerid": 0 }
    SEND(method,params)
}
async function stop() {
    var method = "Player.Stop"
    var params = { "playerid": 0 }
    SEND(method,params)
}
async function previous() {
    var method = "Player.GoTo"
    var params = { "playerid": 0, "to": "previous" }
    SEND(method,params)
}
async function next() {
    var method = "Player.GoTo"
    var params = { "playerid": 0, "to": "next" }
    SEND(method,params)
}
async function reboot() {
    var method = "System.Reboot"
    var params = {}
    SEND(method,params)
}
</script>
</body>
</html>